# Project Overview: Salgstal 3.1

This document provides a high-level overview of the **Salgstal 3.1** application, its architecture, file structure, and data models.

## ğŸ—ï¸ Architecture

**Salgstal 3.1** is a **Multi-Page Application (MPA)** built with vanilla JavaScript, HTML5, and CSS (Tailwind). It focuses on performance and maintainability by avoiding complex build steps or heavy frameworks.

### Key Technologies
- **Frontend**: Vanilla JavaScript (ES6+), Tailwind CSS (via CDN), Chart.js (for visualization).
- **Backend**: None (Serverless/Static). The app runs on a simple local server (e.g., standard Node.js or Python simple server).
- **Data Storage**: Local JSON/JS files and browser LocalStorage/Caching.
- **Excel Processing**: `SheetJS` (xlsx) runs in a Web Worker to convert Excel files to JSON without blocking the UI.

### Core Modules
1.  **Pages**: Separate HTML files for distinct functionality (Dashboard, Advisors, Data).
2.  **Shared Utilities**: A dedicated `js/shared/` layer handles common tasks like date parsing, formatting, and data fetching to prevent code duplication.
3.  **Data Loader**: A centralized `DataLoader` singleton fetches, caches, and manages application state.

---

## ğŸ“‚ File Structure

The project follows a semantic folder structure:

```text
salgstal3.0/
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ images/          # Static assets (logos, profile pictures)
â”œâ”€â”€ data/                # JSON/JS data files acting as the database
â”‚   â”œâ”€â”€ advisors_auth_json_file.json  # Authentication credentials
â”‚   â”œâ”€â”€ sales_goals.js                # Hardcoded sales targets
â”‚   â””â”€â”€ (database files)              # Generated sales data
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ advisors/        # Logic specific to the Advisors page
â”‚   â”œâ”€â”€ dashboard/       # Logic specific to the Dashboard page
â”‚   â”œâ”€â”€ data/            # Logic specific to the Converter page
â”‚   â””â”€â”€ shared/          # Universal utilities (DRY principle)
â”‚       â”œâ”€â”€ data-loader.js
â”‚       â”œâ”€â”€ navigation.js
â”‚       â””â”€â”€ utils.js
â”œâ”€â”€ pages/               # Entry points
â”‚   â”œâ”€â”€ advisors.html
â”‚   â”œâ”€â”€ dashboard.html
â”‚   â””â”€â”€ data.html
â””â”€â”€ index.html           # Gateway (Redirects to Dashboard)
```

---

## ğŸ’¾ Data Structure

The application relies on three main data sources.

### 1. Sales Database (`database.json`)
Generated by the **Data** page converter. It is a JSON object with three main arrays:

```json
{
  "metadata": {
    "lastUpdated": "2025-12-04T10:00:00.000Z"
  },
  "converted": [ ... ],      // Accepted offers
  "nonConverted": [ ... ],   // Offers not yet accepted
  "rejected": [ ... ]        // Lost offers
}
```

**Common Item Fields:**
*   `MASTER_POLICE_NAVN`: (String) Product name (e.g., "HDI - Erhverv").
*   `AARLIG_PRAEMIE`: (Number/String) Annual premium amount.
*   `SAGSBEHANDLER`: (String) Advisor ID or Name.
*   `TILBUD_START_DATO` / `KONVERTERINGS_DATO`: (Date String) The effective sales date.
*   `PRODUKT`: (String) Specific product category.
*   `FORSIKRINGSTAGER_NAVN`: (String) Customer name.
*   `FORSIKRINGSTAGER_CVR`: (String) Customer CVR number.

### 2. Authentication Data (`advisors_auth_json_file.json`)
Used for the Advisor login system.

```json
{
  "manager_code": "leder2025",
  "advisors": [
    {
      "id": "flfa_lb",
      "name": "Flemming F."
    },
    {
      "id": "jlar_lb", 
      "name": "Jakob N. L."
    }
    // ... other advisors
  ]
}
```

### 3. Sales Goals (`sales_goals.js`)
Defines monthly targets for visualization.

```javascript
const sales_goals_data = {
    "all": {
        "2025-01": 1050000,
        // ...
    },
    "hdi": { ... },
    "axa": { ... },
    "nÃ¦rsikring": { ... }
};
```

---

## ğŸ”„ Key Workflows

### Data Conversion & Import
1.  User uploads 4 raw Excel files on the **Data** page.
2.  `js/data/converter-page.js` uses a Web Worker to parse Excel sheets via `SheetJS`.
3.  Data is normalized (mapping headers, formatting dates) and merged into the Sales Database structure.
4.  The result is saved (simulated API call or file download) to update the app's data source.
5.  `DataLoader` cache is cleared to ensure fresh data on the Dashboard.

### Data Loading & Caching
1.  Any page load triggers `DataLoader.loadAll()`.
2.  It checks for valid cached data (5-minute expiry) to ensure instant page loads.
3.  If cache is empty/stale, it fetches `sales_goals.js` and the latest sales data.
4.  Data is attached to the `window` object or returned to the calling function for rendering.

### Advisor Analytics
1.  User logs in on **Advisors** page.
2.  `js/shared/utils.js` provides `mapSagsbehandlerToInitials` to link raw sales data names (e.g., "Flemming Falkengaard") to Advisor IDs (e.g., "flfa_lb").
3.  Charts are rendered using only that advisor's filtered subset of the global data.
